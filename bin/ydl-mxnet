#!/bin/bash
# Kvstore log for Debug
#export PS_VERBOSE=1
#ps-lite/tracker/dmlc_local.py -n 2 -s 2 \

PLATFORM="linux-x86_64-cpu"
LAUNCH_SCRIPT="../../mxnet/tools/launch.py"
MODEL="$1"
#echo $MODEL
NUM_WORKER=2
MXNET_HOME="../mxnet/"

DATA_DIR="data"
if [[ $MODEL == "test" ]]; then
	CLIENT_MAIN_CLASS="ml.dmlc.mxnet.examples.imclassification.TrainMnist"
	MODEL="local"
else
	CLIENT_MAIN_CLASS="ml.dmlc.mxnet.examples.imclassification.GenTrain"
fi
$LAUNCH_SCRIPT -n $NUM_WORKER --launcher $MODEL \
  java -Xmx4G -Djava.library.path=$MXNET_HOME/scala-package/native/$PLATFORM/target/ \
  -cp MXNET_HOME/scala-package/assembly/$PLATFORM/target/*:MXNET_HOME/scala-package/examples/target/*:scala-package/examples/target/classes/lib/* \
  $CLIENT_MAIN_CLASS \
  --data-dir=$DATA_DIR \
  --num-epochs=4 \
  --network=mlp \
  --kv-store=dist_async
